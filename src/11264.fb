\ La aventura de Ug                                                                                                             \ Una aventura conversacional                                   \ troglodita y primitiva                                                                                                        \ 2010-01-29: Version para Abersoft Forth                       \ 2015-02-13: Adaptada a DZX-Forth, para probar                                                                                                                                                                                                                 \ Copyright (C) 1988,2010 Marcos Cruz (programandala.net)                                                                       \ Licencia/Permesilo/License:                                   \ http://programandala.net/licencia                             \ Instrucciones:                                                \ http://programandala.net/es.programa.la_aventura_de_ug        ( Cargador)                                                     FORTH DEFINITIONS DECIMAL : TASK ;                              : .TITULO ." La aventura de Ug" CR CR ;                         PAGE .TITULO .( Cargando...)                                    2 #screens 1- thru                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ( Variables y utilidades)                                       0 VARIABLE LUGAR 0 VARIABLE ORDEN 0 VARIABLE COMPLEMENTO        7 CONSTANT #OBJETOS 0 VARIABLE OBJETOS #OBJETOS 2 - ALLOT       4 CONSTANT #SALIDAS ( puntos cardinales)                        255 CONSTANT X ( punto cardinal sin salida)                     254 CONSTANT MANO ( localizacion de objetos en inventario)      255 CONSTANT LIMBO ( localizacion de objetos eliminados)        4 CONSTANT COLOR 7 CONSTANT COLOR-ORDEN 2 CONSTANT COLOR-MUERTO \ : DEPTH ( --u) SP@ S0 @ - -2 / ;                              : OBJETO ( u--a) OBJETOS + ;                                    : AHI ( u1 u2--) OBJETO C! ; : CERRADA? ( a--f) X = ;           : DONDE ( u1--u2) OBJETO C@ ;                                   : AQUI? ( u--f) DONDE LUGAR @ = ;                               : MIO? ( u--f) DONDE MANO = ;                                   : MIO ( u--) MANO SWAP AHI ;                                    : PAUSE KEY DROP ; : B- 0 BRIGHT ; : B+ 1 BRIGHT ;              ( Vocabulario)                                                  0 DUP CONSTANT VE CONSTANT VETE                                 1 DUP DUP CONSTANT DEJA CONSTANT SUELTA CONSTANT TIRA           2 DUP DUP DUP                                                   CONSTANT COGE CONSTANT TOMA CONSTANT AGARRA CONSTANT RECOGE     : LA ; : EL ; : HACIA ; : AL ;                                  0 DUP CONSTANT NORTE CONSTANT N                                 1 DUP CONSTANT SUR CONSTANT S                                   2 DUP CONSTANT ESTE CONSTANT E                                  3 DUP CONSTANT OESTE CONSTANT O                                 4 CONSTANT HUEVO 5 CONSTANT PALO 6 CONSTANT SERPIENTE           : .COMPLEMENTO ( u--) CASE N OF ." NORTE" ENDOF S OF ." SUR"    ENDOF E OF ." ESTE" ENDOF O OF ." OESTE" ENDOF                  HUEVO OF ." HUEVO" ENDOF                                        PALO OF ." PALO" ENDOF SERPIENTE OF ." SERPIENTE" ENDOF         ENDCASE ;                                                       ( Mapa)                                                         0 CONSTANT CUEVA 1 CONSTANT PANTANO 2 CONSTANT POZO             3 CONSTANT CAMINO 4 CONSTANT VALLE 5 CONSTANT DESFILADERO       6 CONSTANT ATAJO 7 CONSTANT LAGO 8 CONSTANT GRUTA : X, X C, ;   0 VARIABLE (MAPA) ( cueva:) X, CAMINO C, X, X,                  ( pantano:) X, VALLE C, X, X, ( pozo:) X, X, X, X,              ( camino:) CUEVA C, ATAJO C, VALLE C, X,                        ( valle:) PANTANO C, LAGO C, DESFILADERO C, CAMINO C,           ( desfiladero:) POZO C, GRUTA C, X, VALLE C,                    ( atajo:) CAMINO C, GRUTA C, LAGO C, X, ( lago:) X, X, X, X,    ( gruta:) DESFILADERO C, X, X, X,                               : MAPA ( --a) (MAPA) 2+ ; : >MAPA ( u--a) #SALIDAS * MAPA + ;   : .SALIDA ( a u--) SWAP OVER + C@ CERRADA?                      IF DROP ELSE .COMPLEMENTO SPACE THEN ;                                                                                                                                                          ( Argumento)                                                    : QUE COLOR-ORDEN PAPER QUIT ;                                  0 VARIABLE MUERTO : MUERE 1 MUERTO ! QUE ; : VIVE 0 MUERTO ! ;  : VIVO? MUERTO @ IF COLOR-MUERTO PAPER                          CR ." UG HA MUERTO Y NO PUEDE OIRTE" SP! CR                     ." QUIZA QUIERAS " B+ ." EMPEZAR" B- ."  OTRA VEZ" QUE THEN ;   : PELEA SERPIENTE AQUI?                                         IF CR ." LA SERPIENTE SE CABREA Y ME     ATACA"                 CR PALO MIO? IF ." PERO LA GOLPEO CON EL PALO Y LA DEJO TIESA"  LIMBO SERPIENTE AHI                                             ELSE ." ME PEGA UN BOCADO Y LA PALMO AL INSTANTE" MUERE         THEN THEN ;                                                     : OBJETIVO HUEVO MIO? IF CR ." LO CONSEGUI"                     CR ." EL HUEVO YA ESTA EN MI CUEVA" QUE THEN ;                  : PERDIDO LIMBO PALO AHI LIMBO HUEVO AHI                        CR ." SI LLEVABA ALGO LO HE PERDIDO ENEL AGUA CENAGOSA" ;       ( Paisaje y cambio de lugar)                                    : .SALIDAS CR ." HAY SALIDA HACIA: " CR                         LUGAR @ >MAPA #SALIDAS 0 DO DUP I .SALIDA LOOP DROP ;           : .E ." ESTOY EN " ; : .PAISAJE ( u--) CR CASE                  CUEVA OF .E ." MI CUEVA" OBJETIVO ENDOF                         PANTANO OF .E ." EL PANTANO" PERDIDO ENDOF                      POZO OF ." CAIGO EN UN POZO SECO Y ME MATO" MUERE ENDOF         CAMINO OF .E ." UN CAMINO DESIERTO" ENDOF                       VALLE OF .E ." UN VALLE VERDE" ENDOF                            DESFILADERO OF .E ." UN DESFILADERO" ENDOF                      ATAJO OF .E ." EL ATAJO DE LA COLINA" ENDOF                     LAGO OF ." CAIGO AL LAGO HELADO Y MUERO" MUERE ENDOF            GRUTA OF .E ." LA GRUTA MISTERIOSA" ENDOF ENDCASE .SALIDAS ;    : .QUE CR ." Y AHORA QUE?" QUE ;                                                                                                                                                                ( Movimiento y objetos presentes)                               : SALIDA ( u1 u2--u3)                                           #SALIDAS * MAPA + + C@ ;                                        0 VARIABLE VISTO                                                : .VEO VISTO @ 0= IF CR ." VEO: " THEN 1 VISTO ! ;              : .VISTO ( u--) DUP AQUI?                                       IF .VEO .COMPLEMENTO ELSE DROP THEN ;                           : .VISTOS 0 VISTO ! SERPIENTE 1+ HUEVO DO I .VISTO LOOP ;       : >LUGAR ( u--) DUP LUGAR ! .PAISAJE .VISTOS PELEA ;            : MOVER COMPLEMENTO @ LUGAR @ SALIDA DUP CERRADA?               IF DROP CR ." NO HAY SALIDA HACIA EL " COMPLEMENTO @            .COMPLEMENTO ELSE >LUGAR THEN ;                                                                                                                                                                                                                                                                                                 ( Manipular objetos)                                            : HECHO CR ." HECHO!" ;                                         : DEJAR COMPLEMENTO @ MIO?                                      IF LUGAR @ COMPLEMENTO @ AHI HECHO                              ELSE CR ." NO LO TENGO!"                                        THEN ;                                                          : COGER COMPLEMENTO @ MIO?                                      IF CR ." YA LO TENGO"                                           ELSE COMPLEMENTO @ AQUI?                                        IF COMPLEMENTO @ MIO HECHO                                      ELSE CR ." NO VEO ESO POR AQUI"                                 THEN THEN ;                                                                                                                                                                                                                                                                                                                     ( Comprobaciones)                                               : FUERA? ( n1 n2 n3--f) DUP >R SWAP > SWAP R> SWAP < OR ;       : ENTRE? ( n1 n2 n3--f) FUERA? 0= ;                             : COMPLEMENTO? ( n1 n2--f) COMPLEMENTO @ ENTRE? ;               : ORDEN? ( n1 n2--f) ORDEN @ ENTRE? ;                           : PORTABLE? ( --f) HUEVO SERPIENTE COMPLEMENTO? ;               : DIRECCION? ( --f) NORTE OESTE COMPLEMENTO? ;                  : NO CR ." NO PUEDO HACER ESO" ;                                : FRASE? ( u1 u2--f) DEPTH 2 = IF COMPLEMENTO ! ORDEN !         VE COGE ORDEN? NORTE SERPIENTE COMPLEMENTO? AND                 ELSE SP! 0 THEN ;                                                                                                                                                                                                                                                                                                                                                                               ( Principal)                                                    : UG ( u1 u2--) COLOR PAPER VIVO? FRASE?                        IF ORDEN @ CASE                                                 VE OF DIRECCION? IF MOVER ELSE NO THEN ENDOF                    DEJA OF PORTABLE? IF DEJAR ELSE NO THEN ENDOF                   COGE OF PORTABLE? IF COGER ELSE NO THEN ENDOF                   ENDCASE .QUE                                                    ELSE CR ." NO ENTIENDO" CR                                      THEN ;  ' overprint alias gover                                 : COLORES 0 FLASH B- 0 GOVER 0 INK COLOR PAPER COLOR BORDER ;   : EMPEZAR COLORES CLS 0 LIST                                    GRUTA HUEVO AHI DESFILADERO SERPIENTE AHI VALLE PALO AHI        ."   " B+ ." Pulsa una tecla para empezar" B- SPACE             PAUSE CLS .TITULO VIVE CUEVA >LUGAR .QUE ;                      EMPEZAR                                                                                                                         