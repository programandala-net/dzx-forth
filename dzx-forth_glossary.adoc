= DZX-Forth Glossary
:author: Marcos Cruz (programandala.net)
:revdate: 2014-12-28
:toc: left
:toc-placement!:

// /////////////////////////////////////////////////////////////
// TODO

// 2014-12-28:
//
// One list of words in alphabetic order with several section indexes?
// Or several sections with one alphabetical index?
//
// Cross references.
//
// Problem: The AsciiDoctor + and ++ markups are not rendered;
// backticks work.

// /////////////////////////////////////////////////////////////
// History of this document

// 2014-12-18:
//
// Copied from CP/M DX-Forth v4.09.
//
// 2014-12-28:
//
// Start convertion to Asciidoctor.  The next goal will be to combine
// this document with the Z80 source.  This way the source will be
// fully documented, and there will be no duplicated or outdated info.
// In order to build the package, a Vim program will extract the
// glossary documentation from the source and will include it into the
// main manual.
//
// Problem: not all words in this glossary are in the main source
// file, because many words are defined in Forth files (multitasking,
// tools...). This makes preferible not to embed the glossary into the
// source.
//

// /////////////////////////////////////////////////////////////
// Main

toc::[]

:numbered:
== Stack notation
:numbered!:

.Numbers

|===
| Number    | Type                           | Cells | Range

| a         | address                        | 1     | 0..65535
| aa        | aligned address                | 1     | 0..65535
| ca        | character-aligned address      | 1     | 0..65535
| fa        | float-aligned address          | 1     | 0..65535
| pa        | CPU port address               | 1     | 0..255

| true      | boolean true -1                | 1     | -1
| false     | boolean false 0                | 1     | 0
| flag      | boolean true or false          | 1     | -1 or 0
| ior       | input/output result            | 1     | 0..255

| n         | signed number                  | 1     | -32768..32767
| +n        | positive number                | 1     | 0..32767
| u         | unsigned number                | 1     | 0..65535
| len       | unsigned number, a zone length | 1     | 0..65535
| x         | unspecified number             | 1     | -32768..65535
| d         | signed double number           | 1     | -2147483648..2147483647
| +d        | positive double number         | 2     | 0..2147483647
| ud        | unsigned double number         | 2     | 0..4294697295
| xd        | unspecified double number      | 2     | -2147483648..4294697295
| r         | real number                    | 2     | +-5E-39..1E38
| c         | character or byte              | 1     | 0..255

|===

NOTE: As DZX-Forth does not executes on an architecture requiring
address alignment, all address types may be used interchangeably.

.Input stream

ccc ::
any arbitrary blank-delimited character string or word name
parsed from the input stream

"ccc"::
same as for ccc; typically shown within a stack comment but
represents characters parsed from the input stream.

:numbered:
== Attributes
:numbered!:

[horizontal]
I       :: Words that have the immediate flag set
79      :: Words defined in the Forth-79 Standard
83      :: Words defined in the Forth-83 Standard
94      :: Words defined in the Forth-94 Standard (also known as ANS Forth or ISO Forth)
Gforth  :: Words defined in Gforth
FIG     :: Words defined in the fig-Forth model
ZX      :: Words specific to the ZX Spectrum

:numbered:
== Disk File Interface
:numbered!:

Note: When a file function returns a non-zero ior then an error has
occurred.  Refer to DXFORTH.TXT for a list of ior values and their
corresponding DOS error.

=== #FCB  ( -- u )

A VALUE indicating the maximum number of file handles available.
The default is 10.  #FCB represents the maximum number of files
that may be open at any one.  If more (or less) handles are
required the number may be changed as follows e.g.

     20 TO #FCB  COLD

The above would change the maximum number of handles to 20.

=== +EXT  ( ca1 u1 ca2 u2 -- ca3 u3 )

Conditionally append the file extension ca2 u2 to the filename
string ca1 u1 to produce ca3 u3.  If a1 u1 does not
already contain an extension (the '.' character is not present)
then trailing blanks are removed and ca2 u2 is appended.
Formerly named +FILENAME .

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

See: >FNAME

=== -EXT  ( ca u1 -- ca u2 )

Delete any extension from the filename string ca u1.  The
resulting string is ca u2.  Formerly named -FILENAME .

=== -PATH  ( ca u1 -- ca u2 )

Delete any path from the filename string ca u1.  The resulting
string is ca u2.

=== >DRIVE  ( n1 -- n2 )

Convert logical drive number (0=default, 1=A, 2=B, etc) to absolute
drive number (0=A, 1=B, 2=C, etc).  Formerly named >DISK .

=== >FCB  ( ca1 u1 -- a2 u2 )

Parse the filename string ca1 u1 into a temporary 36-byte file
control block.  A maximum of two such FCB's can exist in the buffer
at one time.  a2 is the address of the FCB and u2 is the parsed
user number.

Note: The temporary file control block resides in a transient
region and may be overwritten by subsequent operations.

DZX-Forth functions that use >FCB include: DELETE-FILE RENAME-FILE

See: >FNAME SETFCB

=== >FNAME  ( ca1 u -- ca2 )

Convert the string ca1 u to a zero-terminated counted string
ca2 in the filename buffer.  A maximum of two filenames can
exist in the buffer at one time.  ca2 returns the counted
string, whereas ca2 + 1 returns the zero-terminated string.

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

DZX-Forth functions that use >FNAME or the filename buffer include:
PATH +EXT OPEN-FILE CREATE-FILE DELETE-FILE RENAME-FILE >FCB

=== >IOR  ( n -- ior )

Convert a DOS error code n to a DZX-Forth I/O result code by
replacing the high-byte of n with $FE.  If n was zero then no error
is assumed and ior is zero.

=== BIN  ( fam1 -- fam2 )  I 94

Modify the file access method fam1 to additionally select a binary
- i.e. not line oriented - file access method, giving access method
fam2.  BIN has no effect under CP/M.

=== CLOSE-FILE  ( fid -- ior )  94

If open, close the disk file associated with the current file-
handle.  If the file could not be closed, ior is non-zero.

=== CREATE-FILE  ( ca u fam -- fid ior )  94

Create and open a disk file specified by the filename ca u
using file access method fam.  Valid fam are R/W (read/write)
R/O (read-only) and W/O (write-only).

If a file with the same name already exists it will be erased.
The file-pointer is set to the start of the file.  If the file
could not be created, ior is non-zero.

=== DELETE-FILE  ( ca u -- ior )  94

Delete the disk file specified by the string ca u.  If the
file could not be deleted, ior is non-zero.

Note: DELETE-FILE must not be performed on an open file.

=== FILE-POSITION  ( fid -- ud ior )  94

Return the current position the file-pointer of the disk file
associated with the handle fid.  If an error occurs ior is
non-zero and ud is undefined.

=== FILE-SIZE  ( fid -- ud ior )  94

Return the current size in bytes of the disk file associated
with handle fid.  For CP/M this number will be a multiple of
128.  If an error occurs ior is non-zero and ud is undefined.

=== GETUSR  ( -- u )

Return the current CP/M disk user number.

=== OPEN-FILE  ( ca u fam -- fid ior )  94

Open the existing disk file specified by the filename ca u
using file access method fam.  Valid fam are R/W (read/write)
R/O (read-only) and W/O (write-only).  If the file could not be
opened, ior is non-zero.

=== PATH  ( u1 -- ca u2 ior )

Get the full directory path for disk drive u1.  If an error occurs,
ior is non-zero.  The returned string ca u2 includes the drive
letter, current user number and trailing colon.  For the currently
selected drive u1 = 0, otherwise u1 = 1 for drive A, 2 for drive B
etc.

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

=== READ-FILE  ( ca u1 fid -- u2 ior )  94

Read u1 bytes from the disk file associated with the current file-
handle into memory starting at c-addr.  If ior is zero, u2 is the
number of bytes received.  If end of file is reached before any
bytes are read u2 is zero.

=== READ-LINE  ( ca u1 fid -- u2 flag ior )  94

Read a line of text from the disk file associated with file-handle
fid into memory starting at address c-addr.  At most u1 characters
are read.  If ior is zero and flag is true, u2 is the number
characters received not including the line terminator.  If u2 = u1
then a line terminator was not yet received.  If an end-of-text
character (1A hex) is read or the end of the file is reached
before any other character is read then flag is false.  The line
terminator may be CRLF (CP/M) or LF (UNIX).

=== REC!  ( d a -- )

Convert double number d to an integral number of 128-byte records
and store in a 3-byte field at address a (least significant
byte first).  Partial records are ignored.  Maximum value of d is
8 Mbytes for CP/M 2 and 32 Mbytes for CP/M 3.

See: REC@

=== REC@  ( a -- d )

Fetch the number of 128-byte records stored in the 3-byte field
at address a (least significant byte first) and convert to the
corresponding number of bytes d.  Maximum value of d is 8 Mbytes
for CP/M 2 and 32 Mbytes for CP/M 3.

See: REC!

=== REPOSITION-FILE  ( ud fid -- ior )  94

Reposition the file-pointer of the disk file associated with the
file-handle fid to position ud.  If the file is positioned outside
the file boundaries or an error occured, ior is non-zero.  If
ud = 0 the file-pointer is positioned at the start of the file.

=== RENAME-FILE  ( ca1 u1 ca2 u2 -- ior )  94

Rename the disk file specified by ca1 u1 to the new name
ca2 u2.  If the file cannot be found or the new name already
exists then ior is non-zero.  Any drive/user prefix attached to
the new name is ignored and is assumed to be the same as the old
name.

Note: RENAME-FILE must not be performed on an open file.

=== RESET-DISKS  ( -- )

Reset all disks to read/write status.  The currently logged drive
and user number are unchanged.  RESET-DISKS is used after a disk
change has occured.

=== RSTUSR  ( -- )

Restore the CP/M disk user number previously saved by SETUSR.

See: SETUSR

=== SETDMA  ( a -- )

Set the disk memory transfer address to addr.  The default CP/M DMA
address is $80.

Note: The disk memory transfer is a transient region which may be
changed by subsequent operations.  DZX-Forth functions that affect
the DMA address include: READ-FILE READ-LINE WRITE-FILE WRITE-LINE.
Several DOSLIB functions also use SETDMA.

=== SETFCB  ( ca1 u1 a2 -- u2 )

Parse the filename string specified by ca1 u1 in the form

     [[d][u]:]filename[.typ]

into the File Control Block at addr2.  Leading spaces are skipped.
The filename may optionally contain a drive letter (A-P) and/or
user number u (0-15 for CP/M, 0-31 for Z-System).  If a drive/user
is not specified, the current drive/user will be assumed.  The
following characters are treated as delimiters:

space tab . , : ; < = > _ control-characters

Note: Only the first 33 bytes of the File Control Block at a2
are initialized.  The parsed user number is not acted upon but
returned as u2.  Formerly named PARSE-FILENAME .

=== SETUSR  ( u -- )

Set the current CP/M disk user number to u (0-15 for CP/M, 0-31
for Z-System).  The previous user number is saved.

See: RSTUSR

=== WRITE-FILE  ( ca u fid -- ior )  94

Write u bytes from memory starting at ca to the disk file
associated with the current file-handle.  If the disk was full
or an error occured, ior is non-zero.

=== WRITE-LINE  ( ca u fid -- ior )  94

Write a line of text ca u followed by the CP/M line terminator
(CRLF) to the disk file associated with file-handle fid.  If the
disk was full or an error occured, ior is non-zero.


:numbered:
== Screen Files
:numbered!:

In DZX-Forth several screenfiles (default is 6) may be open at any one
time.  The most recently opened file is termed the "current" file.  All
screen/block words operate on the current file.

Screen/block numbers are valid only in the range 0 to 8191.  Only one
block buffer is allocated in memory, thus BLOCK and BUFFER always return
the same physical address.

DZX-Forth also supports text source files.  See the section 'Tools' for
details.

=== #SCREENS  ( -- +n )

Return the number of screens (blocks) in the current screenfile.

=== ?BLOCK  ( -- )

If the contents of BLK is non-zero reload the current block.

=== B/BUF  ( -- u )  FIG

A VALUE returning the number of bytes per block buffer.  Default
is 1024.

Note: Must be a multiple of 128 and a maximum of 1280.

=== C/L  ( -- u )  FIG

A VALUE returning the number of characters per line in a screen
block.  Default is 64.

=== CLOSE  ( -- )

Flush and close the current screenfile.  No errors are reported
with this function.

=== CLOSE-ALL  ( -- )

Perform CLOSE on all open source files beginning with the current
screenfile.  Any open text files are also closed with this
function.

=== FILE?  ( -- flag )

Return true if the current screenfile is open otherwise return
false.

=== FILEBLOCKS  ( +n -- )

Resize the current screenfile to +n blocks.  If n is less than the
current size, the screenfile is truncated otherwise the file is
extended and the new blocks are filled with blanks.

=== FLOAD  ( +n "filename[.SCR]" -- )

Save the current screenfile specification then open the specified
file and load block +n.  At completion of the load, close the file
and restore the previous file.  If the filename does not include
an extension then .SCR is assumed.  Screenfiles may be nested.

Note: Read-only files cannot be opened with this function.

=== GETFILENAME  ( "filename" -- ca u )

Parse a filename string from the input stream returning ca u.
An exception occurs if the string is empty.

=== LOADED  ( +n1 +n2 ca u -- )

Save the current screenfile specification then open the file
specified by ca u and load blocks +n1 thru +n2.  At completion
close the file and restore the previous.  If the filename does not
include an extension then .SCR is assumed.  Screenfiles may be
nested.

Note: Read-only files cannot be opened with this function.

=== LOADFILE  ( -- ca u )

Return a string containing the name of the current sourcefile.
If no sourcefile is open or the input source is the console,
ca u is ambiguous.  Formerly named FNAME FILENAME .

See: FILE?

=== LOADLINE  ( -- u )

Return the current line number of the text file being INCLUDEd.
Starting line number is 1.

=== OPEN  ( ca u fam -- ior )

Open the specified disk file according to file access method fam
as the current screenfile.  If an error occurs, ior is non-zero.
If the filename does not include an extension then .SCR is
assumed.

Note: The programmer is responsible for closing or maintaining the
previous current screenfile.

See: SWAP-FILE CLOSE CLOSE-ALL

=== SWAP-FILE  ( -- )

Switch the current and 'swap' screenfiles.  SCR is preserved
across swaps.

Note: SWAP-FILE causes the current block buffer to be unassigned.
The contents of the buffer, however, are not affected.

See: FYI

=== USING  ( "filename[.SCR]" -- )

Close the current screenfile.  Open or conditionally create the
specified disk file for read/write as the current screenfile.  If
the filename does not include an extension then .SCR is assumed.
If the file cannot be opened/created then ABORT is performed.
SCR is set to 0.

Note: Read-only files cannot be opened with this function.
The programmer is responsible for closing or maintaining the
previous current screenfile.

See: SWAP-FILE CLOSE CLOSE-ALL


:numbered:
== Tools
:numbered!:

Note: These words are available only after the file TOOLS.SCR has been
loaded.

 (*                                                    I

Begin a block comment.  Parse and discard text delimited by the
token *) .  If the parse area is exhausted before the delimiter
is found refill the input buffer and resume the process.

An ambiguous condition exists if the delimiter is not found and
the parse area cannot be refilled.

Note: (* is primarily intended for text files.  May be relocated
to the kernel if/when it gains greater popularity.

=== -TOOLS  ( -- aa )

A MARKER word used for deleting the tools utilities with FORGET.

Note: MARKER differs from the Forth-94 specification.

=== .S  ( -- )

Display the values on the data and floating-point stacks.

=== ?  ( aa -- )

Display the single-cell value stored at a-addr.  Display as signed
number if base is decimal or unsigned otherwise.

=== B  ( -- )

Decrement variable SCR and list the screen.

See: L N

=== DELETE  ( "filename" -- )

Erase the specified file from disk.  DELETE must not be performed
on an open file.

=== DIR  ( "filename" -- )

List the current disk directory.  Filename if specified may
include path and wildcards.

=== DUMP  ( a u -- )

Dump u bytes of memory starting at the address addr.

=== EDIT  ( | scr -- )

Performs the same function as EDIT in the screenfile editor.  If
the editor is not resident then EDITOR.SCR is first loaded.  If
scr is not given then editing begins at the position where the
last error occured.

=== FYI  ( -- )

"For Your Information".  Display information about the current
forth environment including dictionary size, vocabularies, logged
drive and open screenfiles.  Formerly named MAP .

=== ICLOSE  ( -- )

Close the current text file.

INCLUDEd text files are automatically closed after loading.  If
an error occurs or loading is interrupted (e.g. QUIT was executed),
nested text files may remain open preventing external editing or
cause difficulty loading ("too many files" error message).  Should
this occur use ICLOSE or CLOSE-ALL to restore proper operation.

Note: Performing ICLOSE without a preceding INCLUDE or INCLUDED
may result in the current screenfile being closed without
flushing.

See: INCLUDE INCLUDED CLOSE-ALL

=== INCLUDE  ( "filename[.F]" -- )

Compile the ascii text source file specified by the filename.
If a filename extension is not included then .F is assumed.
Text files may be nested.

Note: Uses the default DTA buffer at address $80.

See: ICLOSE

=== INCLUDED  ( ca u -- )

Compile the ascii text source file specified by the filename
given by ca u.  Text files may be nested.

Note: Uses the default DTA buffer at address $80.

See: ICLOSE

=== INDEX  ( +n1 +n2 -- )  FIG

List line 0 of screens +n1 thru +n2 from the screenfile.  Line 0
typically contains a comment indicating the contents of the screen.

See: QX

=== L  ( -- )

List the screen specified by variable SCR.

See: N B

=== N  ( -- )

Increment variable SCR and list the screen.

See: L B

=== QX  ( +n -- )

Quick index.  Starting with screen +n, list line 0 of 60 sequential
screens from the screenfile.  Line 0 typically contains a comment
indicating the contents of the screen.

See: INDEX

=== RENAME  ( "oldfile" "newfile" -- )

Rename the specified disk file with a new name.  RENAME must not
be performed on an open file.

=== SHOW  ( +n1 +n2 -- )

List screens +n1 through +n2 from the screenfile to the printer,
formatted 3 screens to the page.  A form-feed character (0C hex) is
output at the end of each page.

=== VOCS  ( -- )

List all vocabularies beginning with the most recent.

=== WORDS  ( -- )

Lists the names of forth words in the first search wordlist
beginning with the most recent.  Immediate words are preceded with
a '#' character and system words with a '|' character.  fig-forth
equivalent is VLIST.

=== WORDS-LIKE  ( "pattern" -- )

As for WORDS but takes a blank delimited string from the input
stream.  Only word names that include the specified string are
listed.


:numbered:
== DOS Interface
:numbered!:

=== CMDTAIL  ( -- ca u )

Return the string representing the command tail entered at the DOS
prompt when the program was first initiated.  Leading and trailing
blanks are stripped.

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

=== BDOS  ( DE u -- A )

Perform CP/M BDOS call number u.  DE is the value passed to the
DE register.  Return the contents of the A register.

See: FDOS

=== BIOS  ( BC u -- A )

Perform CP/M BIOS call number u.  BC is the value passed to the
BC register.  Return the contents of the A register.

Note: CP/M 3 compatible.

=== BIOSHL  ( DE BC u -- HL )

Perform CP/M BIOS call number u.  DE and BC are the values passed
to the DE and BC registers respectively.  Return the contents of
the HL register.

Note: CP/M 3 compatible.

=== DOSVER  ( -- H L )

Return DOS version number.  H = 00h for CP/M, L = BDOS version
number in hexadecimal.

=== FDOS  ( DE u -- HL A )

Perform CP/M BDOS call number u.  DE is the value passed to the
DE register.  Return the contents of the HL and A registers.

See: BDOS

=== PC@  ( pa -- u )

Perform the 8080 IN instruction on port address pa and return
the value u.  The upper 8 bits of u is set to zero.  Fig-Forth
equivalent is P@.

=== PC!  ( u pa -- )

Perform the 8080 OUT instruction sending the lower 8 bits of u to
port address p-addr.  Fig-Forth equivalent is P!

=== ZENV  ( -- a | false )

Return the Z-System external Environment Descriptor address.
If Z-System is not present return false.


:numbered:
== Input/Output
:numbered!:

=== (D.)  ( d -- ca u )

Convert the signed double number d to a string ca u.
Primitive for D.

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

=== .  ( x -- )

Remove single number x from the stack.  If BASE is decimal display
x as a signed number, or unsigned otherwise.

=== CONSOLE  ( -- )

Redirect EMIT to the console screen.

=== SYS-VEC  ( -- a )

Return the address of the system vector & parameter table.

offset      type  function            parameter        default

0   vKEY?   xt    KEY?                -- flag          ?terminal
2   vKEY    xt    KEY                 -- char          conin
4   vEMIT   xt    EMIT                char --          conout *
6   vCON    xt    CONSOLE out         char --          conout
8   vLST    xt    PRINTER out         char --          lstout
10  aINIT   a  INIT patch          --               NOOP *
12  aIDENT  a  IDENTIFY patch      --               NOOP *
14  aFNUMB  a  FNUMBER patch       ca u -- ?|0  FALSE *
16  reserved
18  aNUMB   a  NUMBER? patch       ca u -- ?|0  NUMBER?
20  reserved
22  reserved
24  nUS     u     USER area size
26  nPNO    u     HOLD buffer size
28  reserved
30  reserved

* set according to mode or installed option

Sizes are expressed in bytes unless otherwise noted.

=== KEY  ( -- char )  94

Receive the next character from the console.

=== KEY?  ( -- flag )  94

Return true if a console key has been pressed.  KEY is subsequently
used to retrieve the character.  fig-Forth equivalent is ?TERMINAL.

=== PRINTER  ( -- )

Redirect EMIT to the printer.

=== OUT  ( -- aa )  FIG

A USER variable that contains the number of characters output by
EMIT or TYPE since the last CR.


:numbered:
== Arithmetic and Stack
:numbered!:

=== -ROLL  ( xu ... x1 x0 u -- x0 xu ... x1 )

Remove u.  Rotate xu ... x1 to the top of the stack pushing x0 to
the position vacated by xu.  The reverse of ROLL.

=== -ROT  ( x1 x2 x3 -- x3 x1 x2 )

Rotate the top stack item to the third position.  The reverse of
ROT.

=== 2+  ( x1 -- x2 )  FIG 83

Add two (2) to n1|u1 giving the sum n2|u2.

=== 2-  ( x1 -- x2 )  83

Subtract two (2) to n1|u1 giving the sum n2|u2.

=== 2NIP  ( x1 x2 x3 x4 -- x3 x4 )

Drop cell pair x1 x2 from the stack leaving x3 x4.

=== ><  ( x1 -- x2 )

Swap the high order byte (bits 8-15) with the low order byte
(bits 0-7) of x1.

=== FM/MOD  ( d n1 -- n2 n3 )  94

Divide double number d by single n1, giving the floored quotient
n3 and the remainder n2.

=== LOHI  ( x -- lo hi )

Split a 16-bit number.  Lo is the low byte of x.  Hi is the high
byte of x.

=== LO|HI  ( lo hi -- x )

Form a 16-bit number.  Lo is the low byte of x.  Hi is the high
byte of x.

=== LSHIFT  ( x1 u -- x2 )  94

Perform a logical left shift of u bit-places on x1 giving x2.
Put zero into the least significant bits vacated by the shift.

=== M*  ( n1 n2 -- d )  94

Multiply n1 by n2 giving the double result d.

=== M*/  ( d1 n1 +n2 -- d2 )  94

Multiply double number d1 by single n1 producing the triple
length intermediate result t.  Divide t by +n2 giving the
double quotient d2.

=== M+  ( d1 n -- d2 )  94

Add single length number n to double d1, giving the sum d2.

=== NIP  ( x1 x2 -- x2 )  94

Drop the first item below the top of stack.

=== NOT  ( x -- flag )   79

Reverse the boolean value of x.  Functionally equivalent to: 0= .

Note: Do not confuse this function with FORTH-83 NOT which behaved
as INVERT.

=== RSHIFT  ( x1 u -- x2 )  94

Perform a logical right shift of u bit-places on x1 giving x2.
Put zero into the most significant bits vacated by the shift.

=== SM/REM  ( d n1 -- n2 n3 )  94

Divide d by n1, giving the single-cell remainder n2 and the single-
cell symmetric quotient n3.  An ambiguous condition exists if n1 is
zero.

=== TUCK  ( x1 x2 -- x2 x1 x2 )  94

Copy the first (top) stack item below the second stack item.

=== U2/  ( x1 -- x2 )

x2 is the result of shifting x1 one bit toward the least-significant
bit, leaving the most-significant bit zero.  Equivalent to: 1 RSHIFT.

=== UMAX  ( u1 u2 -- u1 | u2 )

Return the greater of two unsigned numbers.

=== UMIN  ( u1 u2 -- u1 | u2 )

Return the lesser of two unsigned numbers.


:numbered:
== Conversion
:numbered!:

=== DPL  ( -- aa )  83

A USER variable containing the number of places to the right of
the decimal point following number input conversion.

In DZX-Forth DPL is incremented for each character successfully
converted by >NUMBER.  Applications may use this feature to create
custom number conversion routines.

See: NUMBER?

=== NUMBER?  ( ca u -- d true | false )

Convert the case-insensitive string ca u to a double number
according to the current base.  If successful, return double
number d and a true flag.  A leading '-' character signifies a
negative number.  If a punctuation character '.' occurs at the
end of the string then DPL is 0 otherwise it is -1.  If conversion
is unsuccessful or the string was empty or contained blanks then a
false flag is returned and DPL is meaningless.

See: DPL SYS-VEC

=== UPCASE  ( c1 -- c2 )

Convert the character c1 to its uppercase equivalent c2.

Note: The name of this function is subject to change.

=== UPPER  ( ca u -- )

Convert the character string ca u to uppercase.

Note: The name of this function is subject to change.


:numbered:
== Strings and Memory
:numbered!:

=== +STRING  ( ca1 u1 ca2 u2 -- ca2 u3 )

Append the string ca1 u1 to the end of string ca2 u2
returning the resulting string ca2 u3.  It is the programmer's
responsibility to ensure sufficient room is available at ca2
to hold both strings.

=== ,"  ( "ccc<">" -- )

Parse the character string delimited by '"' and compile as a
counted string at HERE.  The delimiter character may be included
in the string by entering it twice.

See: PARSE$

=== /STRING  ( ca1 u1 n -- ca2 u2 )  94

Truncate the string ca1 u1 by n characters.  The resulting
string ca2 u2 begins at ca1+n and has a length u1-n.
n may be negative.

=== CAPS  ( -- )

Causes the next occurrence of COMPARE or SEARCH to be performed as
if all characters in the source and destination strings were
uppercase.  Used in the form:

         ( ca1 u1 ca2 u2 ) CAPS COMPARE
         ( ca1 u1 ca2 u2 ) CAPS SEARCH

Note: The effect of CAPS is temporary.  It is automatically reset
by COMPARE SEARCH COLD, or when an error occurs and QUIT is
executed.

=== CELL-  ( aa1 -- aa2 )

Subtract the size in address units of a cell to aa1, giving
a-addr2.

=== COMPARE  ( ca1 u1 ca2 u2 -- -1 | 0 | 1 )  94

Compare string ca1 u1 with string ca2 u2.  Return 0 if
match, -1 if ca1 u1 is less than ca2 u2 or 1 if greater.

See: CAPS

=== CTOGGLE  ( x ca -- )

Exclusive-or the byte stored at ca with x.

=== MOVE  ( aa1 aa2 u -- )  94

Move u bytes from aa1 to aa2 without overlap.

=== OFF  ( aa -- )

Clear all bits of the cell at a-addr.  Equivalent to: 0 aa !

=== ON  ( aa -- )

Set all bits of the cell at a-addr.  Equivalent to: TRUE aa !

=== PACKED  ( ca1 u ca2 -- ca2 )

Store the string ca1 u as a counted string at ca2 leaving
the destination address on the stack.  The source and destination
strings are permitted to overlap.  An ambiguous condition exists
if u is greater than 255 or the buffer at ca2 is less than u+1
characters.

See: PLACE

=== PAD  ( -- ca )

Return the address of a transient region that can be used to hold
data for intermediate processing.  PAD is at least 84 characters.

Note: In DZX-Forth PAD is located in the APPLICATION data-space
immediately above the pictured numeric output buffer.  The maximum
size of PAD is:  APPLICATION UNUSED PAD HERE - - U.

=== PARSE$  ( char "ccc<char>" -- ca u )

Parse ccc delimited by char and store the string (255 characters
maximum) in a temporary buffer.  The delimiter character may be
included in the string by entering it twice.

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

PARSE$ is used by S" .( and ," .  PARSE$ and WORD share the same
buffer by default.  Simultaneous use is permitted provided the
combined length of the strings does not exceed 255+31 chars.  As
the buffer returned by WORD builds downwards, its length is limited
to that of the returned string plus the count and trailing space
characters.

=== PLACE  ( ca1 u ca2 -- )

Store the string ca1 u as a counted string at c-addr2.  The
source and destination strings are permitted to overlap.  An
ambiguous condition exists if u is greater than 255 or the buffer
at ca2 is less than u+1 characters.  Equivalent to: PACKED DROP

See: PACKED

=== S"  ( compilation: "ccc<">" -- ) ( run-time: -- ca u )  I 94

Parse a string (255 characters maximum) from the input stream
delimited by '"' and compile into the current definition.  The
delimiter character may be included in the string by entering it
twice.  At runtime, leave the string address and count on the
stack.

When interpreting, the string is placed in a transient region
which may be overwritten by subsequent operations.

S" is state-smart.

See: PARSE$

=== S,  ( ca +n -- )

Compile string ca +n (255 characters maximum) as a counted
string at HERE.

Named STRING, $, in some Forth implementations.

=== S.R  ( ca n1 n2 -- )

Display string ca n1 right-aligned in a field n2 characters
wide.  If the number of characters required to display the string
is greater than n2, all characters are displayed with no leading
spaces in a field as wide as necessary.
Equivalent to: OVER - SPACES TYPE

=== SCAN  ( ca1 u1 char -- ca2 u2 )

Scan the string ca1 u1 for the character char.  Leave match
address ca2 and length remaining u2.  If no match occurred
then u2 is zero and ca2 is ca1 + u1.

=== SEARCH  ( ca1 u1 ca2 u2 -- ca3 u3 -1 | ca1 u1 0 )  94

Search string ca1 u1 for the occurence of string ca2
u2.  If found, return -1 and the match address ca3 with
u3 characters remaining.

See: CAPS

=== SKIP  ( ca1 u1 char -- ca2 u2 )

Skip leading occurences of the character char in the string
ca1 u1.  Leave the address of the first non-matching character
ca2 and length remaining u2.  If no characters were skipped
leave ca1 u1.

=== SLITERAL  ( compilation: ca1 u -- ) ( run-time: -- ca2 u )  I 94

Compile the string ca u (255 characters maximum) into the
dictionary.  When later executed ca2 u is left on the stack.


:numbered:
== Dictionary
:numbered!:

=== (NAME)  ( nfa -- ca u )

Return the string ca u representing the name of the forth word
whose name field address is nfa.

Note: The returned string resides in a transient region which may
be overwritten by subsequent operations.

=== -?  ( -- )

Suppress redefinition and system compilation warnings for the next
definition only.

See: WARNING

=== .ID  ( nfa -- )

Display the name of the forth word whose name field address is
nfa.  If the word is nameless (nfa is zero) then "[noname]" is
displayed.  fig-FORTH equivalent is ID.

=== .NAME  ( xt -- )

Display the name of the forth word whose execution token address
is xt.  If the word is nameless or xt invalid then "[noname]" is
displayed.  If the word is an alias then the primary name is
displayed.

=== .VOC  ( wid -- )

Display the name associated with wordlist wid.  Wordlists may be
nameless in which case "[noname]" will be displayed.

See: VOCABULARY W>NAME

=== APPLICATION  ( -- )

Place subsequent definitions into the Application dictionary.  The
application dictionary holds words that may be executed by turnkey
programs.  Equivalent to: FALSE SYS !

Note: APPLICATION is the default mode on boot-up or COLD.

See: SYS SYSTEM

=== BEHEAD  ( "name1" "name2" -- )

Search the first wordlist in the search order and make invisible
the words between name1 and name2 inclusively.  Beheaded words
will not be found in a wordlist search or displayed by WORDS.  The
behaviour of beheaded words is not affected.  An error message is
issued if the names reside in protected dictionary.  Formerly named
EXCISE .

See: CHECKING

=== CHAIN  ( "name" -- )

Append vocabulary "name" to the base of the CURRENT wordlist.  An
error message is issued if "name" is not a vocabulary, is the same
as, is already chained, or was created later than, the CURRENT
vocabulary.

=== CONTEXT  ( -- aa )  83

A variable which determines the dictionary search order.  CONTEXT @
returns the wid of the first wordlist in the current search order.

=== DP  ( -- aa )  FIG

A double USER variable containing pointers to the next free
address in the application and system dictionaries.  e.g.

  DP @   ( -- appDP )
  DP 2@  ( -- sysDP appDP )

=== EMPTY  ( -- )

Delete all definitions created since the last execution of COLD
or FREEZE.  Wordlist is set to FORTH.

=== FORGET  ( "name" -- )  FIG 83

If word "name" is found in the compilation wordlist, delete it
and all words added to the dictionary after "name" was defined,
regardless of their wordlist.  An error message is issued if
"name" is an alias or the word is located in the protected
dictionary.

See: CHECKING

=== FREEZE  ( -- )

Protect the current state of the dictionary.  Existing definitions
will no longer be able to be erased.

See: CHECKING

=== LIMIT  ( -- a )  FIG

A CONSTANT that returns the upper limit address of the application
dictionary and the start of the System dictionary.

LIMIT for TURNKEY applications will be the upper memory limit
currently used by the forth compiler (usually BDOS base) unless set
to a user-specified value with SET-LIMIT.

See: SET-LIMIT

=== LINK,  ( aa -- )

Add a node to linked list a-addr.  The node is created at HERE
and consists initially of one cell containing the address of the
previous node.  Equivalent to: HERE OVER @ , SWAP !

=== MARKER  ( "name" -- )

A defining word used in the form:

         MARKER name

Typically used to mark the beginning of an application which may
later be removed by executing FORGET name.  "name" is placed in
the System dictionary.

Note: MARKER differs from the Forth-94 specification.

=== N>NAME  ( nfa1 -- nfa2 | 0 )

Given the name field address of a word, return the nfa of the
previous word in the wordlist.  If the end of the wordlist is
reached then 0 is returned.

=== REMEMBER  ( xt -- )

Append execution token xt to the REMEMBER list.

When words are discarded or the dictionary is otherwise reduced,
xt's in the REMEMBER list that lie outside the new dictionary
boundary will be executed beginning with the most recent.
Typically xt represents a function whose purpose is to restore
critical system values to their previous state.  Executed xt's
are automatically removed from the REMEMBER list.

Note: Functions executed by the REMEMBER list run only after the
new dictionary boundary has been established.  Consequently these
functions may be residing in free memory when executed.

=== SET-LIMIT  ( a -- )

Set the value of LIMIT for TURNKEY applications to addr.  If a
does not lie on a 16-byte boundary, it is first rounded down.
Typically used prior to executing TURNKEY.

SET-LIMIT only affects applications saved with TURNKEY.  Executing
COLD in the forth environment resets LIMIT to the default value.
It is the programmer's responsibility to ensure sufficient memory
is available for the demands of the application.

See: LIMIT UNUSED

=== SYS  ( -- aa )

A VARIABLE that determines the compilation dictionary.  Definitions
will be compiled to the system dictionary if SYS is non-zero and to
the application dictionary if zero.

See: APPLICATION SYSTEM

=== SYSTEM  ( -- )

Place subsequent definitions into the System dictionary.  The
System dictionary holds the compiler and other support functions
not generally required for turnkey applications.
Equivalent to: TRUE SYS !

See: SYS APPLICATION

=== VOC-LINK  ( -- aa )  FIG

A USER variable containing a pointer to the most recently defined
wordlist.

=== VOCABULARY  ( "name" -- )  83

Create a new empty wordlist.  When "name" is later executed replace
the first wordlist in the search order with the wordlist associated
with "name".  a "name" @ returns the wordlist identifier wid.

=== W>NAME  ( wid -- nfa | 0 )

Return the name field address of the most recently defined word in
wordlist wid.  If the wordlist is empty then zero is returned.

=== WARNING  ( -- aa )

A VARIABLE that controls warning messages.  When set to zero, word
redefinition and System compilation warnings are disabled.  Users
may set WARNING to TRUE or FALSE (e.g. using ON or OFF ) - other
values must not be used.

See: -?


:numbered:
== Facility
:numbered!:

=== AT-XY  ( x y -- )   94

Move the cursor to the specified coordinates relative to the
current text window.

=== BEEP  ( -- )

Generate a bell sound.

=== CLEAR-LINE  ( -- )

Delete all characters from the current cursor position to the end
of the line.  The cursor position remains unchanged.

=== DELETE-LINE  ( -- )

Delete the line at the current cursor position.  All subsequent
lines are moved up one position.  An empty line appears at the
bottom of the screen.

=== EXIT-VIDEO  ( -- )

Send video terminal reset sequence.

=== HIGHLIGHT  ( -- )

Begin standout video mode (usually reverse or bright).

=== INIT-VIDEO  ( -- )

Send video terminal initialisation sequence.

=== INSERT-LINE  ( -- )

Insert an empty line at the current cursor position.  All
subsequent lines in the text window are moved down one position.
The bottom line is lost.

=== MS  ( u -- )   94

Delay u milliseconds.

Note: The accuracy of this function is determined by the 16-bit
value at memory location 292 ($0124).  The default value is 4
which assumes a 4MHz Z80 CPU.  Change the value by manually
patching the memory location, or using INSTALL.COM.  With the
correct value installed the following should produce a 10 second
delay:  BEEP 10000 MS BEEP

=== NORMAL  ( -- )

End standout video mode.

=== PAGE  ( -- )   94

For the console, clear the text screen window and place the cursor
at the upper left; otherwise output a formfeed character (0C hex).
In DZX-Forth, PAGE is equivalent to: 12 EMIT.

See CONSOLE PRINTER.


:numbered:
== Miscellaneous
:numbered!:

=== 'NEXT  ( -- a )

Return the address of the centralized NEXT routine - the forth
"address interpreter".

=== 'SOURCE  ( -- aa )

A double variable containing the current parameters for SOURCE.
'SOURCE 2@ is the equivalent of SOURCE.

=== (EXIT)  ( -- )

Run-time prodecure compiled by EXIT.  Exit the current colon
definition and return control to the calling definition.

=== -->  ( -- )  I FIG 83

Continue interpretation on the next sequential block.  May be
used within a colon definition that crosses a block boundary.

=== @EXECUTE  ( i*x aa -- i*y )

Execute xt located at address a-addr.  If xt is zero then no
action is performed.  Other stack effects are due to the word
executed.

Named PERFORM in some Forth implementations.

=== ADDR  ( "name" -- aa )  I

"address of".  Return the data field address of the word "name".

An ambiguous condition exists if "name" was not created by VALUE
DEFER CREATE VARIABLE 2VARIABLE CONSTANT 2CONSTANT VOCABULARY and
other functions as may be specified.

Named &OF or & in some Forth implementations.

ADDR is state-smart.

=== AKA  ( "oldname" "newname" -- )

"Also Known As".  Create an alias name "newname" for existing word
"oldname".  If oldname was immediate then newname will be
immediate.

Note: In DZX-Forth aliases consume only header space, and the xt of
an alias is the same as the xt of the original word.  The function
appears in other Forth implementations albeit with different names
and usage e.g. SYNONYM ALIAS .

=== BETWEEN  ( n1|u1 n2|u2 n3|u3 -- flag )

Perform a comparison of a test value n1|u1 with a lower limit
n2|u2 and an upper limit n3|u3, returning true if either (n2|u2
<= n3|u3 and (n2|u2 <= n1|u1 and n1|u1 <= n3|u3)) or (n2|u2 >
n3|u3 and (n2|u2 < n1|u1 or n1|u1 < n3|u3)) is true, returning
false otherwise.  An ambiguous condition exists if n1|u1, n2|u2,
and n3|u3 are not all the same type.

This is similar to WITHIN with the exception that the limits are
inclusive.

=== BIOS-IO  ( -- )

Set console output and keyboard input to use BIOS calls.  BIOS-IO
is the default mode.

See: DOS-IO

=== BUILD  ( xt "name" -- )

Skip leading space delimiters.  Parse name delimited by a space.
Create a definition for name with the execution semantics specified
by xt.  If the data-space pointer is not aligned, reserve enough
data space to align it.  The new data-space pointer defines name's
data field.  BUILD does not allocate data space in name's data
field.  When name is executed name's data field address is placed
on the data stack and execution proceeds according to the semantics
given by xt.

BUILD provides an alternative to CREATE ... DOES> .  Typical use:

    SYSTEM
    : CONSTANT  ['] @  BUILD , ;
    APPLICATION

BUILD may be used outside a definition e.g.

    \ adapted from a posting by "Bee" on c.l.f.

    :NONAME ( aa -- )
      BASE @ >R C@ BASE ! U. R> BASE ! ; ( xt)

    ( xt) DUP BUILD B. ( u -- )  2 C,
          DUP BUILD O. ( u -- )  8 C,
              BUILD H. ( u -- ) 16 C,

=== BYE  ( -- )  FIG 94

Perform CLOSE-ALL and EXIT-VIDEO then exit to the operation system
with 0 RETURN.

=== CASE  ( -- )  I 94

Mark the start of a CASE construct.  Used in the form:

     CASE  x1
       x2  OF ... ENDOF
       x3  OF ... ENDOF
       ( x1)
     ENDCASE

In DZX-Forth CASE is a synonym for COND .

=== CATCHER  ( -- aa )

A USER variable containing the last exception handler.  If the
contents is zero no more exception frames (installed by CATCH)
are present.

=== CHAR  ( -- c )  94

Parse the next word in the input stream and return the ASCII
value of the first character.

=== COLD  ( -- )  FIG

Cold restart the forth environment or turnkey application.

 COMPILE                                               83

COMPILE is obsolete and should not be used directly in
applications.  COMPILE is a factor of POSTPONE and is present in
the dictionary as a named word for error handling purposes.

=== COND  ( C: -- mark )  I

Mark the start of a COND construct.  Used in the form:

     COND  x1
       x2  OF ... ELSE
       x3  OF ... ELSE
       ( x1)
     THENS

     COND  x1
       x2 EQUAL  x3 x4 RANGE  WHEN ... ELSE
       ( x1)

See: THENS "Miser's CASE"

=== DEFER  ( "name" -- )

Creates a deferred word whose action word may be subsequently
altered using the sequence: ' ccc IS name

Deferred words are used to create forward references that will be
resolved later.  A run-time error occurs if an attempt is made to
execute an uninitiated deferred word.

Note: The current action of a deferred word may be obtained
using

  ' >BODY @  ( "name" -- xt )  or
  a @     ( "name" -- xt )

See: IS

=== DOS-IO  ( -- )

Set console output to use DOS calls.  May be used to support
command-line redirection, screen pausing and control-C in
applications.

See: BIOS-IO

=== DXFORTH  ( -- minor major )

Return the DZX-Forth version number.

=== ENDCASE  ( x -- )  I 94

Mark the end of a CASE construct.  Discard x.

See CASE OF ENDOF THENS.

=== ENDOF  ( -- )  I 94

Mark the end of an OF ENDOF pair.  In DZX-Forth ENDOF is a synonym
for ELSE .

See CASE OF ENDCASE.

=== EVALUATE  ( ca u -- )  94

Save the current input source specification.  Make the string
described by ca u both the input source and input buffer,
set >IN to zero, and interpret.  When the parse area is empty,
restore the prior input source specification.

=== FDB  ( -- a )

Get the address of the next free file descriptor block.  If no more
free descriptors exist the function aborts with a "too many files"
error message.

=== INTERPRET  ( -- )  FIG

Successively interpret forth text from the input stream until
exhausted, compiling or executing depending upon STATE.  If an
exception occurs the process aborts with an error message.

=== IS  ( xt "name" -- )  I

Used in the form:

         ' ccc IS name

where "name" is a deferred word and ccc defines the new behaviour.

See: DEFER

=== NHOLD  ( n char -- )

Perform HOLD n times.  An ambiguous condition exists if n < 0.

=== NOOP  ( -- )

No operation.  Typically used to set a null action e.g.

         ' NOOP IS XXX

where XXX is a DEFERed word.

=== OF  ( x1 x2 -- )  I 94

If x1 = x2, discard both values and perform the sequence between OF
and ENDOF/ELSE.  Execution then continues after ENDCASE/THENS .  If
x1 <> x2, discard x2 and continue after the corresponding ENDOF/ELSE.

See CASE ENDOF ENDCASE COND THENS.

=== PAUSE  ( -- )

Provides support for multitasking applications.  When the
multitasker is loaded and enabled, PAUSE passes control to the next
task.  Refer to the multitasking documentation for further details.

Note: PAUSE is automatically executed by KEY? KEY EMIT .

=== R0  ( -- aa )  FIG

A USER variable that contains the address of the top of the return
stack.

=== RETURN  ( x -- )

Restore the initial drive path and video mode.  Return to DOS with
exit code x.  Open files are not closed.

See: BYE

=== RP!  ( a -- )

Set the return stack pointer to addr.

=== RP@  ( -- a )  FIG

Return the address of the current return stack pointer.

=== S0  ( -- aa )  FIG

A USER variable that contains the address of the top of the
data stack.

=== SAVE  ( "filename[.COM]" -- )

Save the current forth system image to disk including any new
definitions created.

See: TURNKEY TURNKEY-SYSTEM

=== SHOLD  ( ca u -- )

Add string ca u to the beginning of the pictured numeric
output string.

=== SP!  ( a -- )

Set the data stack pointer to addr.

=== SP@  ( -- a )  FIG

Return the address of the current data stack pointer.

=== THENS  ( C: mark -- )  I

Resolve a COND/CASE construct.

Similar to ENDCASE but does not expect the case selector to be on
the stack.  Named END-CASE in some Forth implementations.

See: COND "Miser's CASE"

=== TOKEN  ( "name" -- ca u )

Parse a blank-delimited string from the input stream.  Equivalent
to: BL WORD COUNT .

=== TURNKEY  ( "bootword" "filename[.EXE]" -- )

Save a standalone application to disk using the specified filename.
When the application is subsequently run, execution begins with
bootword and ends with  0 RETURN  if successful, or  1 RETURN  if
ABORT , ABORT" or an uncaught exception was encountered.

Note: The System dictionary and word headers are not saved and are
therefore unavailable to the application.

See: SAVE TURNKEY-SYSTEM

=== TURNKEY-SYSTEM  ( "bootword" "filename[.EXE]" -- )

Save a standalone application including the System dictionary to
disk using the specified filename.  When the application is
subsequently run, execution begins with bootword and ends with
0 RETURN  if successful, or  1 RETURN  if ABORT , ABORT" or an
uncaught exception was encountered.

TURNKEY-SYSTEM is provided for applications that require access
to words in the System dictionary.

See: SAVE TURNKEY

=== UNNEST  ( -- ) ( R: nest-sys -- )

Discard the calling definition specified by nest-sys.  Before
exiting the current definition, a program shall remove any
parameters the calling definition had placed on the return stack.
An ambiguous condition exists if the current or calling definition
uses locals.

=== UNUSED  ( -- u )  94

Return the amount of space in bytes remaining in the region
addressed by HERE.

Note: The calculation includes a 255 byte safety margin.
Applications should take into account the regions used by the
pictured numeric string buffer and PAD.

=== UDP  ( -- aa )

A VARIABLE that contains the base address of the current USER
area.

=== USER  ( +n "name" -- )  FIG

A defining word used in the form:

         +n USER name

which creates a USER variable "name".  +n is the offset within
the user area where the value for "name" is stored.  Executing
"name" leaves the address of the variable in the user area.

USER variables with offsets 44 decimal and higher are available
for use by applications (DZX-Forth 1.2 for CP/M onwards).

Note: Offsets numbers are subject to change.  When an offset
is required by an application, it should be determined at
compile-time e.g.  [ BASE UP @ - ] LITERAL  will return the
offset for BASE .

=== WITHIN  ( x1 x2 x3 -- flag )  94

Return true if x3 lies within the range x1 to x2-1, otherwise
return false.  x may be signed or unsigned.

=== Y/N  ( -- flag )

Display '(y/n) N' and wait for a single console key.  Return
true if the 'Y' or 'y' key was pressed or false otherwise.

=== [CHAR]  ( -- c )  I 94

Parse the next word in the input stream and compile the ASCII
value of the first character as a literal.

=== [DEFINED]  ( "name" -- flag )  I

Parse the next word in the input stream.  Return a true flag if
word was defined in the dictionary.

=== [IF]  [ELSE]  [THEN]  I 94

// XXX TODO separate and comment

These are the equivalents of IF ELSE THEN but may be used outside
a definition.

=== [UNDEFINED]  ( "name" -- flag )  I

Parse the next word in the input stream.  Return a true flag if
word was not defined in the dictionary.

=== \  ( -- )  I 94

Skip the rest of the line and resume interpretation at the
beginning of the next line.

=== \\  ( -- )  I

Parse and discard the remainder of the parse area.  If the source
is a text file the remainder of the file is discarded.


:numbered:
== Floating Point
:numbered!:

By default DZX-Forth uses single precision software floating point.
A real number occupies two cells (4 bytes) with a maximum precision
of 7 digits and a dynamic range of 5E-39 to 1E38.

The forth interpreter recognizes a number as floating point if it is
in decimal mode and contains an exponent identifier 'E' e.g.  1.0E
3.141952E  1e-12

DZX-Forth uses the data stack for floating point operations (aka common stack
model).

Notes:

- In the common stack model, variables FS0 and FSP are dummies.  Their
  contents are initialized as for S0 but are otherwise unused.

- Floating point display words and their primitives use the pictured
  numeric string buffer.

- Display words that specify the number of places after the decimal
  point may use the value -1 to force compact display mode.


=== (F.)  ( r n -- ca u )

Convert real number r to string ca u in fixed-point notation
with n places to the right of the decimal point.  Primitive used
by F. F.R

=== (FE.)  ( r n -- ca u )

Convert real number r to string ca u in engineering notation
with n places right of the decimal point.  Primitive used by FE.
FE.R

=== (FS.)  ( r n -- ca u )

Convert real number r to string ca u in scientific notation
with n places right of the decimal point.  Primitive used by FS.
FS.R

=== (G.)  ( r n -- ca u )

Convert real number r to string ca u with n places right of the
decimal point.  Fixed-point is used if the exponent is in the range
-4 to 5 otherwise use scientific notation.  Primitive used by G.R
G.

=== -FP  ( -- aa )

A MARKER word used to delete the floating-point with FORGET.

Note: MARKER differs from the Forth-94 specification.

=== >FLOAT  ( ca u -- r true | false )  94

Convert the string ca u to a real number.  If successful,
return the real number r and true or false otherwise.

Note: A zero length string or a string with leading blanks will
return the real number 0.0E and true.

=== D>F  ( d -- r )  94

Convert the double number to its real number equivalent.

=== F!  ( r fa --  )  94

Store r at f-addr.

=== F*  ( r1 r2 -- r3 )  94

Multiply r1 by r2, giving the product r3.

=== F**  ( r1 r2 -- r3 )  94

Raise r1 to the power r2.

=== F+  ( r1 r2 -- r3 )  94

Add r1 to r2, giving the sum r3.

=== F,  ( r -- )

Reserve one floating-point cell of data space and store r in the
cell.

=== F-  ( r1 r2 -- r3 )  94

Subtract r2 from r1, giving the difference r3.

=== F.  ( r -- )

Display r in floating-point notation followed by a space.  Non-
essential zeros and signs are removed.

=== F.R  ( n u -- ) or ( r n u -- )

Display r in fixed-point notation right-justified in a field width
u with n places right of the decimal point.

=== F/  ( r1 r2 -- r3 )  94

Divide r1 by r2, giving the quotient r3.

=== F0<  ( r -- flag )  94

Return true if r is less than zero, or false otherwise.

=== F0=  ( r -- flag )  94

Return true if r is equal to zero, or false otherwise.

=== F0>  ( r -- flag )

Flag is true if r is greater than zero.

=== F<  ( r1 r2 -- flag )  94

Return true if r1 is less than r2, or false otherwise.

=== F>  ( r1 r2 -- flag )

Flag is true if r1 is greater than r2.

=== F>D  ( r -- d )  94

Convert the integer part of r to its double number equivalent.

=== F>S  ( r -- n )

Convert the integer part of r to its single number equivalent.

=== F@  ( fa -- r )  94

Return the value of the real number stored at f-addr.

=== FABS  ( r1 -- r2 )  94

Return the absolute value of r1.

=== FATAN  ( r1 -- r2 )  94

r2 is the principal radian angle whose tangent is r1.

=== FCONSTANT  ( r "name" -- ) 94

Define a floating point constant having the value r.

=== FCOS  ( r1 -- r2 )  94

r2 is the cosine of the radian angle r1.

=== FDP  ( -- aa )

A VARIABLE that controls floating decimal point display.  If zero
then trailing decimal points are not shown; if non-zero a decimal
point is always shown.  Default is FDP ON.

=== FDROP  ( r --  )  94

Remove r from the stack.

=== FDUP  ( r -- r r )  94

Duplicate r.

=== FE.  ( r -- )

Display r in engineering notation followed by a space.  Non-
essential zeros and signs are removed.

=== FE.R  ( r n u -- )

Display r in engineering notation right-justified in a field width
u with n places to the right of the decimal point.

=== FEXP  ( r1 -- r2 )  94

Raise e to the power r1, giving r2.

=== FLITERAL  ( compilation: r -- ) ( runtime: -- r )  94

Compile r into the dictionary.  When later executed r is left on
the stack.

=== FLN  ( r1 -- r2 )  94

r2 is the natural logarithm of r1.

=== FLOOR  ( r1 -- r2 )  94

Round r1 to an integral value using the "round toward negative
infinity" rule, giving r2.

=== FMAX  ( r1 r2 -- r3 )  94

r3 is the maximum of r1 and r2.

=== FMIN  ( r1 r2 -- r3 )  94

r3 is the minimum of r1 and r2.

=== FNEGATE  ( r1 -- r2 )  94

Negate r1, giving r2.

=== FOVER  ( r1 r2 -- r1 r2 r1 )  94

Place a copy of r1 on top of the stack.

=== FPICK  ( ru ... r0 u -- ru ... r0 ru )

Remove u.  Copy ru to the top of the stack.

=== FRANDOM  ( r1 -- r2 )

If r1 is a positive non-zero number, return a psuedo-random number
r2 uniformly distributed in the range 0.0E to (but not including)
1.0E.  If r1 is zero, return the last random number generated.  If
r1 is negative, r1 is used to re-seed the random number generator.

=== FROT  ( r1 r2 r3 -- r2 r3 r1 )  94

Rotate r1 to the top of the stack.

=== FROUND  ( r1 -- r2 )  94

Round r1 to an integral value using the "round to nearest" rule,
giving r2.

=== FS.  ( r -- )

Display r in scientific notation followed by a space.  Non-
essential zeros and signs are removed.

=== FS.R  ( r n u -- )

Display r in scientific notation right-justified in a field width
u with n places to the right of the decimal point.

=== FS0  ( -- aa )

A USER variable that contains the address of the top of the
separate floating point stack.

Note: Has no function in the common stack floating point model

=== FSIN  ( r1 -- r2 )  94

r2 is the sine of the radian angle r1.

=== FSP  ( -- aa )

A VARIABLE that returns the address of the current separate
floating point stack pointer.

Note: Has no function in the common stack model

=== FSQRT  ( r1 -- r2 )  94

r2 is the square root of r1.

=== FSWAP  ( r1 r2 -- r2 r1 )  94

Exchange the top two floating point numbers.

=== FVARIABLE  ( compilation: -- ) ( run-time: -- fa )  94

Define a floating point variable.

=== G.  ( r -- )

Display real number r in floating point notation followed by a
space.  If the exponent is outside the range -4 to 5 then
scientific notation is used.  Non-essential zeros and signs are
removed.

=== G.R  ( r n u -- )

Display real number r followed by a space.  Floating-point is used
if the exponent is in the range -4 to 5 otherwise use scientific
notation.  Non-essential zeros and signs are removed.

=== MAX-PRECISION  ( -- u )

A CONSTANT returning the implementation-defined maximum PRECISION.

See: SET-PRECISION

=== PI  ( -- r )

An FCONSTANT that returns the value for "pi" (3.141593..)

=== PRECISION  ( -- u )  94

Return the number of significant digits currently used by F. F.R
FS. FS.R

=== REPRESENT  ( r ca n1 -- n2 flag1 flag2 )  94

DZX-Forth uses an enhanced REPRESENT.  It follows the Forth-94
definition with the following extensions:

- if n1 is zero the entire significand of r is rounded to one or
  zero following the system's rounding rule; if n1 is negative
  then r is rounded to zero.
- the buffer size allocated at ca shall be the greater of n1
  or MAX-PRECISION.

See:
ftp://ftp.taygeta.com/pub/Forth/Applications/ANS/Represent_30.txt

=== S>F  ( n -- r )

Convert the single number to its real number equivalent.

=== SET-PRECISION  ( u -- )  94

Set the number of significant digits currently used by F. F.R FS.
FS.R.  In DZX-Forth, the number of significant digits is limited
to MAX-PRECISION.

:numbered:
== Compiler Security
:numbered!:

=== !CSP  ( -- )  FIG

Save the current data stack position.

See: ?CSP

=== +BAL  ( -- )

Increment the current control structure balance level.

=== -BAL  ( -- )

Decrement the current control structure balance level.

=== ?BAL  ( flag -- )

Issue an error message 'definition unbalanced' and abort if flag
and CHECKING are not zero.

See: CHECKING

=== ?CSP  ( -- )  FIG

Issue an error message 'definition unbalanced' and abort if the
current data stack position does not match the value saved by !CSP
and CHECKING is not zero.

See: CHECKING

=== ?COMP  ( -- )  FIG

Issue an error message 'compilation only' and abort if not
compiling.

=== ?EXEC  ( -- )  FIG

Issue an error message 'execution only' and abort if not
executing.

=== ?STACK  ( -- )  FIG

Issue an error message and abort if a stack underflow or overflow
occurs.  Data, return and floating point stack (if present) are
tested.

Note: A non-System version of ?STACK is provided in MISC.SCR for
turnkey applications requiring run-time stack checking.

=== CHECKING  ( -- aa )

A VARIABLE that controls compiler security - including control
structure balance, data stack level and protected dictionary.
If the contents are zero, checking is disabled.  Default is
CHECKING ON.

See: ?BAL ?CSP BEHEAD FORGET

=== CSP  ( -- aa )  FIG

A VARIABLE containing the current data stack position saved by
!CSP .

=== SMUDGE  ( -- )  FIG

Toggle the 'smudge' bit in the header of the last defined word.
If the smudge bit is set, the definition will not be found during
a dictionary search.


:numbered:
== Control Flow Stack
:numbered!:

In DZX-Forth the control-flow stack is implemented on the data stack.
CS-DROP CS-PUSH CS-POP CS-MARK CS-TEST are available when the 'cfs'
equate in the kernel source is enabled.  See MISER.SCR for example of
use.

=== <MARK  ( C: -- dest )  83

This function is not provided.  In DZX-Forth use  POSTPONE BEGIN
instead.

=== <RESOLVE  ( C: dest -- )  83

Compile a backward branch address in the dictionary using the
location left by BEGIN .  Formerly named BACK .

=== >MARK  ( C: -- orig )  83

Reserve space in the dictionary for a forward branch address
to be later resolved by THEN .  Formerly named FORWARD .

=== >RESOLVE  ( C: orig -- )  83

This function is not provided.  In DZX-Forth use  POSTPONE THEN
instead.

=== AHEAD  ( C: -- orig )  94

Put the location of a new unresolved forward reference orig
onto the control flow stack.  Similar to IF but compiles an
unconditional forward branch.

=== CS-PICK  ( C: xu..x0 -- xu..x0 xu ) ( S: u -- )  94

Remove u.  Place a copy of item xu on top of the control-flow
stack.

=== CS-ROLL  ( C: xu..x0 -- xu-1..x0 xu ) ( S: u --  )  94

Remove u.  Rotate item xu to the top of the control-flow stack.

=== CS-DROP  ( C: x -- )

Remove the top item from the control-flow stack.

=== CS-PUSH  ( C: xu..x1 x0 -- x0 xu..x1 )

Rotate items on the control-flow stack such that the top item
becomes the bottom.  An ambiguous condition exists if the control-
flow stack is empty before CS-PUSH is executed.

=== CS-POP  ( C: xu xu-1..x0 -- xu-1..x0 xu )

Rotate items on the control-flow stack such that the bottom item
becomes the top.  An ambiguous condition exists if the control-
flow stack is empty before CS-POP is executed.

=== CS-MARK  ( C: -- x )

Place a marker on the control-flow stack.  A marker occupies the
same width as an orig|dest but is distinguishable using CS-TEST.

=== CS-TEST  ( C: x -- x ) ( S: -- flag )

Return a true flag if x is an orig|dest, or false if a marker.
x is not altered or removed.

If the control-flow stack is implemented using the data stack,
flag shall be the topmost item on the data stack.

